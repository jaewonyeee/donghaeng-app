{"version":3,"names":["_react","require","_Skia","_ReanimatedProxy","_interopRequireDefault","_video","obj","__esModule","default","defaultOptions","playbackSpeed","looping","paused","seek","currentTime","useOption","value","defaultValue","Rea","useSharedValue","isSharedValue","disposeVideo","video","dispose","useVideo","source","userOptions","_userOptions$paused","_userOptions$looping","_userOptions$seek","_userOptions$playback","useMemo","Skia","Video","isPaused","currentFrame","lastTimestamp","duration","_video$duration","framerate","_video$framerate","rotationInDegrees","_video$getRotationInD","getRotationInDegrees","useFrameCallback","frameInfo","processVideoState","timestamp","useEffect","runOnUI","exports"],"sources":["useVideo.ts"],"sourcesContent":["import { type FrameInfo } from \"react-native-reanimated\";\nimport { useEffect, useMemo } from \"react\";\n\nimport { Skia } from \"../../skia/Skia\";\nimport type { SkImage, Video } from \"../../skia/types\";\n\nimport Rea from \"./ReanimatedProxy\";\nimport {\n  processVideoState,\n  type Animated,\n  type PlaybackOptions,\n} from \"./video\";\n\nconst defaultOptions = {\n  playbackSpeed: 1,\n  looping: true,\n  paused: false,\n  seek: null,\n  currentTime: 0,\n};\n\nconst useOption = <T>(value: Animated<T>) => {\n  \"worklet\";\n  // TODO: only create defaultValue is needed (via makeMutable)\n  const defaultValue = Rea.useSharedValue(\n    Rea.isSharedValue(value) ? value.value : value\n  );\n  return Rea.isSharedValue(value) ? value : defaultValue;\n};\n\nconst disposeVideo = (video: Video | null) => {\n  \"worklet\";\n  video?.dispose();\n};\n\nexport const useVideo = (\n  source: string | null,\n  userOptions?: Partial<PlaybackOptions>\n) => {\n  const video = useMemo(() => (source ? Skia.Video(source) : null), [source]);\n  const isPaused = useOption(userOptions?.paused ?? defaultOptions.paused);\n  const looping = useOption(userOptions?.looping ?? defaultOptions.looping);\n  const seek = useOption(userOptions?.seek ?? defaultOptions.seek);\n  const playbackSpeed = useOption(\n    userOptions?.playbackSpeed ?? defaultOptions.playbackSpeed\n  );\n  const currentFrame = Rea.useSharedValue<null | SkImage>(null);\n  const currentTime = Rea.useSharedValue(0);\n  const lastTimestamp = Rea.useSharedValue(-1);\n  const duration = useMemo(() => video?.duration() ?? 0, [video]);\n  const framerate = useMemo(() => video?.framerate() ?? 0, [video]);\n  const rotationInDegrees = useMemo(\n    () => video?.getRotationInDegrees() ?? 0,\n    [video]\n  );\n  Rea.useFrameCallback((frameInfo: FrameInfo) => {\n    processVideoState(\n      video,\n      duration,\n      framerate,\n      frameInfo.timestamp,\n      {\n        paused: isPaused.value,\n        looping: looping.value,\n        playbackSpeed: playbackSpeed.value,\n      },\n      currentTime,\n      currentFrame,\n      lastTimestamp,\n      seek\n    );\n  });\n\n  useEffect(() => {\n    return () => {\n      // TODO: should video simply be a shared value instead?\n      Rea.runOnUI(disposeVideo)(video);\n    };\n  }, [video]);\n\n  return { currentFrame, currentTime, duration, framerate, rotationInDegrees };\n};\n"],"mappings":"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"}